/*
 * SimpleEdit 1.04, jQuery plugin
 *
 * CopyrightÂ© 2012, Adam Radabaugh
 *
 * Simple editing of values on basic HTML forms.
 * Licensed under the MIT License
 */
(function(a){var b={},c=function(){function t(){d={},e={},g={},h=[],i=0,j=!1,k=!1,l=undefined}function u(a,b){var c="",d="",f=a.children(0);m&&(f=a.children(0).children(0));switch(a.data("se-type")){case"select":c=f.children(0).val(),d=e[b].opts[c];break;case"checkbox":f.children(0).is(":checked")?(c="on",d=e[b].opts.on):(c="",d=e[b].opts.off);break;case"radio":c=f.find("input:checked").val(),d=e[b].opts[c];break;default:c=f.val(),d=c}return a=f=null,{nval:c,ntext:d}}function v(b){b=typeof b!="boolean"?!0:b,m&&a.each(g,function(a,b){b.validationEngine("detach"),b.validationEngine("hideAll")}),a.each(h,function(a,c){c.trigger("restore",[b])}),t()}function w(c){function k(){f=h=i=j=null}var f=!0,h={},i={},j;return a.each(e,function(b,c){m?g[b].validationEngine("validate")?d.hasOwnProperty(b)&&(h[b]=c.newValue,i.hasOwnProperty("fields")||(i.fields={}),i.fields[b]=c,j=e[b].localData,j!=null&&a.extend(h,j)):f=!1:(h[b]=c.newValue,i.hasOwnProperty("fields")||(i.fields={}),i.fields[b]=c,j=e[b].localData,j!=null&&a.extend(h,j))}),a.extend(h,b.ajaxData),a.extend(i,b.ajaxData),f&&!a.isEmptyObject(h)?(typeof p=="function"&&(h=p(h)),h?a.post(b.saveUrl,h,function(b){typeof b=="string"?resp=a.parseJSON(b):resp=b,resp.success?q(undefined,i,b)!==!1&&(v(!1),b=null):v(),c(),k()}):(k(),v())):k(),f}function x(a,b){a.replaceWith(b),a=b=null}function y(c,d){function l(a){a=typeof a!="boolean"?!0:a,a||(h=o(d,e[f]),h!==!1&&(h===""?(h=b.placeholderText,d.addClass(b.placeholderClass)):d.removeClass(b.placeholderClass),d.html(h))),c.find("span.simple-edit-save, span.simple-edit-cancel").show().end().find("div.simple-edit-loader").hide(),x(c,d),t(),c=d=f=g=h=i=j=k=null}var f=d.data("se-name"),g={},h=!0,i={},j={},k=e[f].localData;c.find("span.simple-edit-save, span.simple-edit-cancel").hide().end().find("div.simple-edit-loader").show(),g=u(c,f),e[f].newValue=g.nval,e[f].newText=g.ntext,g.nval!=null&&(i[f]=g.nval,j.fields={},j.fields[f]=e[f]),k!=null&&a.extend(i,k),a.extend(i,b.ajaxData),a.extend(j,b.ajaxData),a.isEmptyObject(i)?l():(typeof p=="function"&&(i=p(i)),i?a.post(b.saveUrl,i,function(b){typeof b=="string"?resp=a.parseJSON(b):resp=b,resp.success?q(d,j,b)!==!1&&l(!1):l(),b=null}):l())}function z(b,c){var d,e,f,g,h=0;switch(b){case"text":case"password":case"email":return a("<input>").addClass(c[3]).attr({id:c[0],name:c[0],type:b}).val(c[1]);case"select":return d=a("<select>").addClass(c[3]).attr({id:c[0],name:c[0]}),e="",a.each(c[2],function(a,b){e=b.toLowerCase()===c[1].toLowerCase()?' selected="selected"':"",d.append('<option value="'+a+'"'+e+">"+b+"</option>")}),e=f=g=h=c=null,a("<span>").addClass("se-field-container").html(d);case"checkbox":return f=c[1].toLowerCase()===c[2].on.toLowerCase()?!0:!1,g=a("<input>").addClass(c[3]).attr({id:c[0],type:"checkbox",name:c[0],checked:f}),f&&(g[0].defaultChecked=!0),e=f=h=c=null,a("<span>").addClass("se-field-container").html(g);case"radio":return d=a("<span>").addClass("se-field-container"),a.each(c[2],function(b,e){f=e.toLowerCase()===c[1].toLowerCase()?!0:!1,g=a("<input>").addClass(c[3]).attr({id:c[0]+""+(h+=1),type:"radio",name:c[0],value:b,checked:f}),f&&(g[0].defaultChecked=!0),d.append(g,e+"<br/>")}),e=f=g=h=c=null,d;case"textarea":return a("<textarea>").addClass(c[3]).attr({id:c[0],name:c[0],rows:3}).html(c[1]);case"datepicker":return l=function(){a("#"+c[0]).datepicker(typeof c[2]=="object"?c[2]:{})},a("<input>").addClass(c[3]).attr({id:c[0],name:c[0],type:"text"}).val(c[1])}}function A(a,b){var c=b.data("se-name"),f={};f=u(a,c),e[c].newValue=f.nval,e[c].newText=f.ntext,d[c]=f.nval,c=f=a=b=null}function B(c,d){function q(){y(k,f),typeof p=="object"&&p.validationEngine("detach"),k=f=p=n=null}function s(){x(k,f),t(),typeof p=="object"&&(p.validationEngine("detach"),p.validationEngine("hideAll")),k=f=p=n=null}function u(){p.validationEngine("validate")&&q()}i+=1;var f=c.clone(!0,!0),k=a("<div>").attr({id:"editingContainer_"+i,"data-se-type":d.data("elementType")}).addClass("simple-edit-container"),n=f.data("se-name"),p;m?(p=a("<form>").html(d),p.validationEngine("attach",b.validationEngineOptions),g[n]=p,k.html(p)):k.html(d),k.append(r(),'<div class="simple-edit-clear"></div>'),j?k.bind("restore",function(a,c){if(!c){var d=o(f,e[n]);d!==!1&&(d===""?(d=b.placeholderText,f.addClass(b.placeholderClass)):f.removeClass(b.placeholderClass),f.html(d))}k.replaceWith(f),k=f=n=null}).delegate("input, select, textarea","change",function(){A(k,f)}).delegate("input, select, textarea","keydown",function(a){var b=a.keyCode||a.charCode,c=a.currentTarget.tagName.toLowerCase();return c!=="textarea"&&b===13||b===27?(a.preventDefault(),b=c=null,!1):(b=c=null,!0)}).find(".simple-edit-single").hide():k.delegate("span.simple-edit-save","click",function(){m?u():q()}).delegate("span.simple-edit-cancel","click",function(){s()}).delegate("input, select, textarea","keydown",function(a){var b=a.keyCode||a.charCode,c=a.currentTarget.tagName.toLowerCase();if(c!=="textarea"&&b===13||b===27)a.preventDefault(),b===13?m?u():q():s();b=c=null}),h.push(k),c.replaceWith(k),typeof l=="function"&&l(),j||k.find("input, select, textarea").eq(0).focus(),c=d=null}function C(c){c.preventDefault();var d=a(b.editAllTrigger),e=s();return j=!0,f=d.clone(!0,!0),d.replaceWith(e.delegate("span.simple-edit-msave","click",function(a){w(function(){e.replaceWith(f),e=f=null})}).delegate("span.simple-edit-mcancel","click",function(a){v(),e.replaceWith(f),e=f=null})),d=null,a(b.editClass).each(function(){a(this).trigger("dblclick")}),!1}function D(c){if(!j&&k||!c[0])return!1;k=!0;var d=a.trim(n(c)),f=c.data("se-type").toLowerCase(),g=c.data("se-opts"),h=c.data("se-ajax-data"),i=c.data("se-validation")||"",l=c.data("se-name"),m=[l,d,g,i],o,p;d.toLowerCase()===b.placeholderText.toLowerCase()?m[1]=d=p="":typeof g=="object"?a.each(g,function(a,b){if(b===d)return p=a,!1}):p=d,o=z(f,m),o.data("elementType",f),B(c,o),e[l]={oldValue:p,oldText:d,newValue:p,newText:d,type:f,opts:g,localData:h},l=d=p=f=g=o=m=h=null}function E(c){a(b.editClass).each(function(){var c=a(this);a.trim(n(c))===""&&c.addClass(b.placeholderClass).html(b.placeholderText)}),a("body").delegate(b.editClass,"dblclick",function(){D(a(this))}),b.editAllDefault&&b.editAllTrigger&&(b.editAllDefault=!1,a(b.editAllTrigger).trigger("click")),c&&!k&&!j&&t()}function F(c){if(a.isEmptyObject(b)){b=a.extend({},a.simpleEdit.defaults,c),b.useValidationEngine&&typeof a.fn.validationEngine!="function"&&(console.error("jQuery.validationEngine does not exist."),b.useValidationEngine=!1);if(b.saveUrl==="")return console.error("No 'saveUrl' was provided for jQuery.simpleEdit."),!1;m=b.useValidationEngine,n=b.beforeFilter,o=b.afterFilter,p=b.beforeSave,q=b.afterSave;if(typeof b.editAllTrigger=="string"&&b.editAllTrigger!=="")a(b.editAllTrigger).live("click",C);else if(b.editAllDefault)return console.error("editAllDefault was set to 'true' without valid editAllTrigger for jQuery.simpleEdit."),!1;E()}}function G(){a("body").undelegate(b.editClass,"dblclick"),a(b.editAllTrigger).die("click",C),t()}var d={},e={},f={},g={},h=[],i=0,j=!1,k=!1,l,m,n,o,p,q,r=function(){return a("<div>").addClass("simple-edit-single").html('<span class="simple-edit-save"><span class="ui-icon ui-icon-check"></span></span><span class="simple-edit-cancel"><span class="ui-icon ui-icon-closethick"></span></span><div class="simple-edit-loader"></div><div class="simple-edit-arrow-border"></div><div class="simple-edit-arrow"></div>')},s=function(){return a("<div>").addClass("simple-edit-mass").html('<span class="simple-edit-msave"><p>Save</p><span class="ui-icon ui-icon-check"></span></span><span class="simple-edit-mcancel"><p>Cancel</p><span class="ui-icon ui-icon-closethick"></span></span>')};return{init:F,update:E,destroy:G}}();a.simpleEdit=function(d,e){typeof d=="string"&&c[d]?(d!=="destroy"&&c.init(),c[d].call()):typeof d=="string"&&b[d]&&e!=null?b[d]=e:typeof d=="object"||!d?c.init(d):console.error("Method "+d+" does not exist in jQuery.simpleEdit.")},a.simpleEdit.defaults={saveUrl:window.location.href,editClass:".editable",editAllDefault:!1,editAllTrigger:"",ajaxData:{},beforeSave:function(b){return b},afterSave:function(b,c,d){},beforeFilter:function(b){return b.text()},afterFilter:function(b,c){return c.newText},useValidationEngine:!1,validationEngineOptions:{scroll:!0},placeholderClass:"simple-edit-placeholder",placeholderText:"Double-click to Edit"}})(jQuery);