/*
 * SimpleEdit 1.05, jQuery plugin
 *
 * CopyrightÂ© 2013, Adam Radabaugh
 *
 * Simple editing of values on basic HTML forms.
 * Licensed under the MIT License
 */
(function($){var settings={},methods=function methods(){function clearState(){c={},d={},forms={},containers=[],numContainers=0,massEdit=!1,editing=!1,postReplace=void 0}function getValue(a,b){var c="",e="",f=a.children(0);switch(useValidation&&(f=a.children(0).children(0)),a.data("se-type")){case"select":c=f.children(0).val(),e=d[b].opts[c];break;case"checkbox":f.children(0).is(":checked")?(c="on",e=d[b].opts.on):(c="",e=d[b].opts.off);break;case"radio":c=f.find("input:checked").val(),e=d[b].opts[c];break;default:c=f.val(),e=c}return a=f=null,{nval:c,ntext:e}}function mcancel(a){a="boolean"!=typeof a?!0:a,useValidation&&$.each(forms,function(a,b){b.validationEngine("detach"),b.validationEngine("hideAll")}),$.each(containers,function(b,c){c.trigger("restore",[a])}),clearState()}function msave(a){function h(){b=e=f=g=null}var g,b=!0,e={},f={};return $.each(d,function(a,h){useValidation?forms[a].validationEngine("validate")?c.hasOwnProperty(a)&&(e[a]=h.newValue,f.hasOwnProperty("fields")||(f.fields={}),f.fields[a]=h,g=d[a].localData,null!=g&&$.extend(e,g)):b=!1:(e[a]=h.newValue,f.hasOwnProperty("fields")||(f.fields={}),f.fields[a]=h,g=d[a].localData,null!=g&&$.extend(e,g))}),$.extend(e,settings.ajaxData),$.extend(f,settings.ajaxData),b&&!$.isEmptyObject(e)?("function"==typeof beforeSave&&(e=beforeSave(e)),e?$.post(settings.saveUrl,e,function(b){resp="string"==typeof b?$.parseJSON(b):b,resp.success?mcancel(afterSave(void 0,f,b)!==!1?!1:!0):mcancel(!0),a(),h()}):(h(),mcancel())):h(),b}function cancel(a,b){a.replaceWith(b)}function save(a,b){function j(j){j="boolean"!=typeof j?!0:j,j||(f=afterFilter(b,d[c]),f!==!1&&(""===f?(f=settings.placeholderText,b.addClass(settings.placeholderClass)):b.removeClass(settings.placeholderClass),b.html(f))),a.find("span.simple-edit-save, span.simple-edit-cancel").show().end().find("div.simple-edit-loader").hide(),cancel(a,b),clearState(),a=b=c=e=f=g=h=i=null}var c=b.data("se-name"),e={},f=!0,g={},h={},i=d[c].localData;a.find("span.simple-edit-save, span.simple-edit-cancel").hide().end().find("div.simple-edit-loader").show(),e=getValue(a,c),d[c].newValue=e.nval,d[c].newText=e.ntext,null!=e.nval&&(g[c]=e.nval,h.fields={},h.fields[c]=d[c]),null!=i&&$.extend(g,i),$.extend(g,settings.ajaxData),$.extend(h,settings.ajaxData),$.isEmptyObject(g)?j():("function"==typeof beforeSave&&(g=beforeSave(g)),g?$.post(settings.saveUrl,g,function(a){resp="string"==typeof a?$.parseJSON(a):a,resp.success?j(afterSave(b,h,a)!==!1?!1:!0):j(!0)}):j())}function getEditor(type,es){var ret,sel,checked,lobj,i=0;switch(type){case"text":case"password":case"email":return $("<input>").addClass(es[3]).attr({id:es[0],name:es[0],type:type}).val(es[1]);case"select":return ret=$("<select>").addClass(es[3]).attr({id:es[0],name:es[0]}),sel="",$.each(es[2],function(a,b){sel=b.toLowerCase()===es[1].toLowerCase()?' selected="selected"':"",ret.append('<option value="'+a+'"'+sel+">"+b+"</option>")}),sel=checked=lobj=i=es=null,$("<span>").addClass("se-field-container").html(ret);case"checkbox":return checked=es[1].toLowerCase()===es[2].on.toLowerCase()?!0:!1,lobj=$("<input>").addClass(es[3]).attr({id:es[0],type:"checkbox",name:es[0],checked:checked}),checked&&(lobj[0].defaultChecked=!0),sel=checked=i=es=null,$("<span>").addClass("se-field-container").html(lobj);case"radio":return ret=$("<span>").addClass("se-field-container"),$.each(es[2],function(a,b){checked=b.toLowerCase()===es[1].toLowerCase()?!0:!1,lobj=$("<input>").addClass(es[3]).attr({id:es[0]+""+(i+=1),type:"radio",name:es[0],value:a,checked:checked}),checked&&(lobj[0].defaultChecked=!0),ret.append(lobj,b+"<br/>")}),sel=checked=lobj=i=es=null,ret;case"textarea":return $("<textarea>").addClass(es[3]).attr({id:es[0],name:es[0],rows:3}).html(es[1]);case"datepicker":case"autocomplete":return postReplace=function(){var elem=$("#"+es[0]),opts;opts="object"==typeof es[2]?es[2]:"string"==typeof es[2]?eval('window["'+es[2].split(".").join('"]["')+'"]'):{},"datepicker"===type?elem.datepicker(opts):"autocomplete"===type&&elem.autocomplete(opts)},$("<input>").addClass(es[3]).attr({id:es[0],name:es[0],type:"text"}).val(es[1])}}function changeEvent(a,b){var e=b.data("se-name"),f={};f=getValue(a,e),d[e].newValue=f.nval,d[e].newText=f.ntext,c[e]=f.nval,e=f=a=b=null}function displayEditor(a,b){function h(){save(e,c),"object"==typeof g&&g.validationEngine("detach"),e=c=g=f=null}function i(){cancel(e,c),clearState(),"object"==typeof g&&(g.validationEngine("detach"),g.validationEngine("hideAll")),e=c=g=f=null}function j(){g.validationEngine("validate")&&h()}numContainers+=1;var g,c=a.clone(!0,!0),e=$("<div>").attr({id:"editingContainer_"+numContainers,"data-se-type":b.data("elementType")}).addClass("simple-edit-container"),f=c.data("se-name");useValidation?(g=$("<form>").html(b),g.validationEngine("attach",settings.validationEngineOptions),forms[f]=g,e.html(g)):e.html(b),e.append(eventHandlerMarkup(),'<div class="simple-edit-clear"></div>'),massEdit?e.bind("restore",function(a,b){if(!b){var g=afterFilter(c,d[f]);g!==!1&&(""===g?(g=settings.placeholderText,c.addClass(settings.placeholderClass)):c.removeClass(settings.placeholderClass),c.html(g))}e.replaceWith(c),e=c=f=null}).delegate("input, select, textarea","change",function(){changeEvent(e,c)}).delegate("input, select, textarea","keydown",function(a){var b=a.keyCode||a.charCode,c=a.currentTarget.tagName.toLowerCase();return"textarea"!==c&&13===b||27===b?(a.preventDefault(),b=c=null,!1):(b=c=null,!0)}).find(".simple-edit-single").hide():e.delegate("span.simple-edit-save","click",function(){useValidation?j():h()}).delegate("span.simple-edit-cancel","click",function(){i()}).delegate("input, select, textarea","keydown",function(a){var b=a.keyCode||a.charCode,c=a.currentTarget.tagName.toLowerCase();("textarea"!==c&&13===b||27===b)&&(a.preventDefault(),13===b?useValidation?j():h():i()),b=c=null}),containers.push(e),a.replaceWith(e),"function"==typeof postReplace&&postReplace(),massEdit||e.find("input, select, textarea").eq(0).focus(),a=b=null}function editAll(a){a.preventDefault();var b=$(settings.editAllTrigger),c=formHandlerMarkup();return massEdit=!0,meclone=b.clone(!0,!0),b.replaceWith(c.delegate("span.simple-edit-msave","click",function(){msave(function(){c.replaceWith(meclone),c=meclone=null})}).delegate("span.simple-edit-mcancel","click",function(){mcancel(),c.replaceWith(meclone),c=meclone=null})),b=null,$(settings.editClass).each(function(){$(this).trigger("dblclick")}),!1}function editSingle(a){if(!massEdit&&editing||!a[0])return!1;editing=!0;var j,k,b=$.trim(beforeFilter(a)),c=a.data("se-type").toLowerCase(),e=a.data("se-opts"),f=a.data("se-ajax-data"),g=a.data("se-validation")||"",h=a.data("se-name"),i=[h,b,e,g];b.toLowerCase()===settings.placeholderText.toLowerCase()?i[1]=b=k="":"object"==typeof e?$.each(e,function(a,c){return c===b?(k=a,!1):void 0}):k=b,j=getEditor(c,i),j.data("elementType",c),displayEditor(a,j),d[h]={oldValue:k,oldText:b,newValue:k,newText:b,type:c,opts:e,localData:f},h=b=k=c=e=j=i=f=null}function attachHandlers(a){$(settings.editClass).each(function(){var a=$(this);""===$.trim(beforeFilter(a))&&a.addClass(settings.placeholderClass).html(settings.placeholderText)}),$("body").delegate(settings.editClass,"dblclick",function(){editSingle($(this))}),settings.editAllDefault&&settings.editAllTrigger&&(settings.editAllDefault=!1,$(settings.editAllTrigger).trigger("click")),!a||editing||massEdit||clearState()}function init(a){if($.isEmptyObject(settings)){if(settings=$.extend({},$.simpleEdit.defaults,a),settings.useValidationEngine&&"function"!=typeof $.fn.validationEngine&&(console.error("jQuery.validationEngine does not exist."),settings.useValidationEngine=!1),""===settings.saveUrl)return console.error("No 'saveUrl' was provided for jQuery.simpleEdit."),!1;if(useValidation=settings.useValidationEngine,beforeFilter=settings.beforeFilter,afterFilter=settings.afterFilter,beforeSave=settings.beforeSave,afterSave=settings.afterSave,"string"==typeof settings.editAllTrigger&&""!==settings.editAllTrigger)$(settings.editAllTrigger).live("click",editAll);else if(settings.editAllDefault)return console.error("editAllDefault was set to 'true' without valid editAllTrigger for jQuery.simpleEdit."),!1;attachHandlers()}}function destroy(){$("body").undelegate(settings.editClass,"dblclick"),$(settings.editAllTrigger).die("click",editAll),clearState()}var c={},d={},meclone={},forms={},containers=[],numContainers=0,massEdit=!1,editing=!1,postReplace,useValidation,beforeFilter,afterFilter,beforeSave,afterSave,eventHandlerMarkup=function getEventHandler(){return $("<div>").addClass("simple-edit-single").html('<span class="simple-edit-save"><span class="ui-icon ui-icon-check"></span></span><span class="simple-edit-cancel"><span class="ui-icon ui-icon-closethick"></span></span><div class="simple-edit-loader"></div><div class="simple-edit-arrow-border"></div><div class="simple-edit-arrow"></div>')},formHandlerMarkup=function getFormHandler(){return $("<div>").addClass("simple-edit-mass").html('<span class="simple-edit-msave"><p>Save</p><span class="ui-icon ui-icon-check"></span></span><span class="simple-edit-mcancel"><p>Cancel</p><span class="ui-icon ui-icon-closethick"></span></span>')};return{init:init,update:attachHandlers,destroy:destroy}}();$.simpleEdit=function simpleEdit(a,b){if("string"==typeof a&&methods[a])"destroy"!==a&&methods.init(),methods[a].call();else if("string"==typeof a&&settings[a]&&null!=b)settings[a]=b;else{if("string"==typeof a&&settings[a]&&null==b)return settings[a];"object"!=typeof a&&a?console.error("Method "+a+" does not exist in jQuery.simpleEdit."):methods.init(a)}},$.simpleEdit.defaults={saveUrl:window.location.href,editClass:".editable",editAllDefault:!1,editAllTrigger:"",ajaxData:{},beforeSave:function beforeSave(a){return a},afterSave:function afterSave(){},beforeFilter:function beforeFilter(a){return a.text()},afterFilter:function afterFilter(a,b){return b.newText},useValidationEngine:!1,validationEngineOptions:{scroll:!0},placeholderClass:"simple-edit-placeholder",placeholderText:"Double-click to Edit"}})(jQuery);
