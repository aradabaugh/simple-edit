/*
 * SimpleEdit 1.05, jQuery plugin
 *
 * CopyrightÂ© 2013, Adam Radabaugh
 *
 * Simple editing of values on basic HTML forms.
 * Licensed under the MIT License
 */
(function(a){var b={},c=function(){function t(){d={},e={},g={},h=[],i=0,j=!1,k=!1,l=undefined}function u(a,b){var c="",d="",f=a.children(0);m&&(f=a.children(0).children(0));switch(a.data("se-type")){case"select":c=f.children(0).val(),d=e[b].opts[c];break;case"checkbox":f.children(0).is(":checked")?(c="on",d=e[b].opts.on):(c="",d=e[b].opts.off);break;case"radio":c=f.find("input:checked").val(),d=e[b].opts[c];break;default:c=f.val(),d=c}return a=f=null,{nval:c,ntext:d}}function v(b){b=typeof b!="boolean"?!0:b,m&&a.each(g,function(a,b){b.validationEngine("detach"),b.validationEngine("hideAll")}),a.each(h,function(a,c){c.trigger("restore",[b])}),t()}function w(c){function k(){f=h=i=j=null}var f=!0,h={},i={},j;return a.each(e,function(b,c){m?g[b].validationEngine("validate")?d.hasOwnProperty(b)&&(h[b]=c.newValue,i.hasOwnProperty("fields")||(i.fields={}),i.fields[b]=c,j=e[b].localData,j!=null&&a.extend(h,j)):f=!1:(h[b]=c.newValue,i.hasOwnProperty("fields")||(i.fields={}),i.fields[b]=c,j=e[b].localData,j!=null&&a.extend(h,j))}),a.extend(h,b.ajaxData),a.extend(i,b.ajaxData),f&&!a.isEmptyObject(h)?(typeof p=="function"&&(h=p(h)),h?a.post(b.saveUrl,h,function(b){typeof b=="string"?resp=a.parseJSON(b):resp=b,resp.success?v(q(undefined,i,b)!==!1?!1:!0):v(!0),c(),k()}):(k(),v())):k(),f}function x(a,b){a.replaceWith(b)}function y(c,d){function l(a){a=typeof a!="boolean"?!0:a,a||(h=o(d,e[f]),h!==!1&&(h===""?(h=b.placeholderText,d.addClass(b.placeholderClass)):d.removeClass(b.placeholderClass),d.html(h))),c.find("span.simple-edit-save, span.simple-edit-cancel").show().end().find("div.simple-edit-loader").hide(),x(c,d),t(),c=d=f=g=h=i=j=k=null}var f=d.data("se-name"),g={},h=!0,i={},j={},k=e[f].localData;c.find("span.simple-edit-save, span.simple-edit-cancel").hide().end().find("div.simple-edit-loader").show(),g=u(c,f),e[f].newValue=g.nval,e[f].newText=g.ntext,g.nval!=null&&(i[f]=g.nval,j.fields={},j.fields[f]=e[f]),k!=null&&a.extend(i,k),a.extend(i,b.ajaxData),a.extend(j,b.ajaxData),a.isEmptyObject(i)?l():(typeof p=="function"&&(i=p(i)),i?a.post(b.saveUrl,i,function(b){typeof b=="string"?resp=a.parseJSON(b):resp=b,resp.success?l(q(d,j,b)!==!1?!1:!0):l(!0)}):l())}function z(b,c){var d,e,f,g,h=0;switch(b){case"text":case"password":case"email":return a("<input>").addClass(c[3]).attr({id:c[0],name:c[0],type:b}).val(c[1]);case"select":return d=a("<select>").addClass(c[3]).attr({id:c[0],name:c[0]}),e="",a.each(c[2],function(a,b){e=b.toLowerCase()===c[1].toLowerCase()?' selected="selected"':"",d.append('<option value="'+a+'"'+e+">"+b+"</option>")}),e=f=g=h=c=null,a("<span>").addClass("se-field-container").html(d);case"checkbox":return f=c[1].toLowerCase()===c[2].on.toLowerCase()?!0:!1,g=a("<input>").addClass(c[3]).attr({id:c[0],type:"checkbox",name:c[0],checked:f}),f&&(g[0].defaultChecked=!0),e=f=h=c=null,a("<span>").addClass("se-field-container").html(g);case"radio":return d=a("<span>").addClass("se-field-container"),a.each(c[2],function(b,e){f=e.toLowerCase()===c[1].toLowerCase()?!0:!1,g=a("<input>").addClass(c[3]).attr({id:c[0]+""+(h+=1),type:"radio",name:c[0],value:b,checked:f}),f&&(g[0].defaultChecked=!0),d.append(g,e+"<br/>")}),e=f=g=h=c=null,d;case"textarea":return a("<textarea>").addClass(c[3]).attr({id:c[0],name:c[0],rows:3}).html(c[1]);case"datepicker":return l=function(){a("#"+c[0]).datepicker(typeof c[2]=="object"?c[2]:{})},a("<input>").addClass(c[3]).attr({id:c[0],name:c[0],type:"text"}).val(c[1])}}function A(a,b){var c=b.data("se-name"),f={};f=u(a,c),e[c].newValue=f.nval,e[c].newText=f.ntext,d[c]=f.nval,c=f=a=b=null}function B(c,d){function q(){y(k,f),typeof p=="object"&&p.validationEngine("detach"),k=f=p=n=null}function s(){x(k,f),t(),typeof p=="object"&&(p.validationEngine("detach"),p.validationEngine("hideAll")),k=f=p=n=null}function u(){p.validationEngine("validate")&&q()}i+=1;var f=c.clone(!0,!0),k=a("<div>").attr({id:"editingContainer_"+i,"data-se-type":d.data("elementType")}).addClass("simple-edit-container"),n=f.data("se-name"),p;m?(p=a("<form>").html(d),p.validationEngine("attach",b.validationEngineOptions),g[n]=p,k.html(p)):k.html(d),k.append(r(),'<div class="simple-edit-clear"></div>'),j?k.bind("restore",function(a,c){if(!c){var d=o(f,e[n]);d!==!1&&(d===""?(d=b.placeholderText,f.addClass(b.placeholderClass)):f.removeClass(b.placeholderClass),f.html(d))}k.replaceWith(f),k=f=n=null}).delegate("input, select, textarea","change",function(){A(k,f)}).delegate("input, select, textarea","keydown",function(a){var b=a.keyCode||a.charCode,c=a.currentTarget.tagName.toLowerCase();return c!=="textarea"&&b===13||b===27?(a.preventDefault(),b=c=null,!1):(b=c=null,!0)}).find(".simple-edit-single").hide():k.delegate("span.simple-edit-save","click",function(){m?u():q()}).delegate("span.simple-edit-cancel","click",function(){s()}).delegate("input, select, textarea","keydown",function(a){var b=a.keyCode||a.charCode,c=a.currentTarget.tagName.toLowerCase();if(c!=="textarea"&&b===13||b===27)a.preventDefault(),b===13?m?u():q():s();b=c=null}),h.push(k),c.replaceWith(k),typeof l=="function"&&l(),j||k.find("input, select, textarea").eq(0).focus(),c=d=null}function C(c){c.preventDefault();var d=a(b.editAllTrigger),e=s();return j=!0,f=d.clone(!0,!0),d.replaceWith(e.delegate("span.simple-edit-msave","click",function(a){w(function(){e.replaceWith(f),e=f=null})}).delegate("span.simple-edit-mcancel","click",function(a){v(),e.replaceWith(f),e=f=null})),d=null,a(b.editClass).each(function(){a(this).trigger("dblclick")}),!1}function D(c){if(!j&&k||!c[0])return!1;k=!0;var d=a.trim(n(c)),f=c.data("se-type").toLowerCase(),g=c.data("se-opts"),h=c.data("se-ajax-data"),i=c.data("se-validation")||"",l=c.data("se-name"),m=[l,d,g,i],o,p;d.toLowerCase()===b.placeholderText.toLowerCase()?m[1]=d=p="":typeof g=="object"?a.each(g,function(a,b){if(b===d)return p=a,!1}):p=d,o=z(f,m),o.data("elementType",f),B(c,o),e[l]={oldValue:p,oldText:d,newValue:p,newText:d,type:f,opts:g,localData:h},l=d=p=f=g=o=m=h=null}function E(c){a(b.editClass).each(function(){var c=a(this);a.trim(n(c))===""&&c.addClass(b.placeholderClass).html(b.placeholderText)}),a("body").delegate(b.editClass,"dblclick",function(){D(a(this))}),b.editAllDefault&&b.editAllTrigger&&(b.editAllDefault=!1,a(b.editAllTrigger).trigger("click")),c&&!k&&!j&&t()}function F(c){if(a.isEmptyObject(b)){b=a.extend({},a.simpleEdit.defaults,c),b.useValidationEngine&&typeof a.fn.validationEngine!="function"&&(console.error("jQuery.validationEngine does not exist."),b.useValidationEngine=!1);if(b.saveUrl==="")return console.error("No 'saveUrl' was provided for jQuery.simpleEdit."),!1;m=b.useValidationEngine,n=b.beforeFilter,o=b.afterFilter,p=b.beforeSave,q=b.afterSave;if(typeof b.editAllTrigger=="string"&&b.editAllTrigger!=="")a(b.editAllTrigger).live("click",C);else if(b.editAllDefault)return console.error("editAllDefault was set to 'true' without valid editAllTrigger for jQuery.simpleEdit."),!1;E()}}function G(){a("body").undelegate(b.editClass,"dblclick"),a(b.editAllTrigger).die("click",C),t()}var d={},e={},f={},g={},h=[],i=0,j=!1,k=!1,l,m,n,o,p,q,r=function(){return a("<div>").addClass("simple-edit-single").html('<span class="simple-edit-save"><span class="ui-icon ui-icon-check"></span></span><span class="simple-edit-cancel"><span class="ui-icon ui-icon-closethick"></span></span><div class="simple-edit-loader"></div><div class="simple-edit-arrow-border"></div><div class="simple-edit-arrow"></div>')},s=function(){return a("<div>").addClass("simple-edit-mass").html('<span class="simple-edit-msave"><p>Save</p><span class="ui-icon ui-icon-check"></span></span><span class="simple-edit-mcancel"><p>Cancel</p><span class="ui-icon ui-icon-closethick"></span></span>')};return{init:F,update:E,destroy:G}}();a.simpleEdit=function(d,e){if(typeof d=="string"&&c[d])d!=="destroy"&&c.init(),c[d].call();else if(typeof d=="string"&&b[d]&&e!=null)b[d]=e;else{if(typeof d=="string"&&b[d]&&e==null)return b[d];typeof d=="object"||!d?c.init(d):console.error("Method "+d+" does not exist in jQuery.simpleEdit.")}},a.simpleEdit.defaults={saveUrl:window.location.href,editClass:".editable",editAllDefault:!1,editAllTrigger:"",ajaxData:{},beforeSave:function(b){return b},afterSave:function(b,c,d){},beforeFilter:function(b){return b.text()},afterFilter:function(b,c){return c.newText},useValidationEngine:!1,validationEngineOptions:{scroll:!0},placeholderClass:"simple-edit-placeholder",placeholderText:"Double-click to Edit"}})(jQuery);(function(a){var b={},c=function c(){function u(){c={},d={},f={},g=[],h=0,i=!1,j=!1,k=void 0}function v(a,b){var c="",e="",f=a.children(0);switch(l&&(f=a.children(0).children(0)),a.data("se-type")){case"select":c=f.children(0).val(),e=d[b].opts[c];break;case"checkbox":f.children(0).is(":checked")?(c="on",e=d[b].opts.on):(c="",e=d[b].opts.off);break;case"radio":c=f.find("input:checked").val(),e=d[b].opts[c];break;default:c=f.val(),e=c}return a=f=null,{nval:c,ntext:e}}function w(b){b="boolean"!=typeof b?!0:b,l&&a.each(f,function(a,b){b.validationEngine("detach"),b.validationEngine("hideAll")}),a.each(g,function(a,c){c.trigger("restore",[b])}),u()}function x(e){function k(){g=h=i=j=null}var j,g=!0,h={},i={};return a.each(d,function(b,e){l?f[b].validationEngine("validate")?c.hasOwnProperty(b)&&(h[b]=e.newValue,i.hasOwnProperty("fields")||(i.fields={}),i.fields[b]=e,j=d[b].localData,null!=j&&a.extend(h,j)):g=!1:(h[b]=e.newValue,i.hasOwnProperty("fields")||(i.fields={}),i.fields[b]=e,j=d[b].localData,null!=j&&a.extend(h,j))}),a.extend(h,b.ajaxData),a.extend(i,b.ajaxData),g&&!a.isEmptyObject(h)?("function"==typeof o&&(h=o(h)),h?a.post(b.saveUrl,h,function(b){resp="string"==typeof b?a.parseJSON(b):b,resp.success?w(p(void 0,i,b)!==!1?!1:!0):w(!0),e(),k()}):(k(),w())):k(),g}function y(a,b){a.replaceWith(b)}function z(c,e){function l(a){a="boolean"!=typeof a?!0:a,a||(h=n(e,d[f]),h!==!1&&(""===h?(h=b.placeholderText,e.addClass(b.placeholderClass)):e.removeClass(b.placeholderClass),e.html(h))),c.find("span.simple-edit-save, span.simple-edit-cancel").show().end().find("div.simple-edit-loader").hide(),y(c,e),u(),c=e=f=g=h=i=j=k=null}var f=e.data("se-name"),g={},h=!0,i={},j={},k=d[f].localData;c.find("span.simple-edit-save, span.simple-edit-cancel").hide().end().find("div.simple-edit-loader").show(),g=v(c,f),d[f].newValue=g.nval,d[f].newText=g.ntext,null!=g.nval&&(i[f]=g.nval,j.fields={},j.fields[f]=d[f]),null!=k&&a.extend(i,k),a.extend(i,b.ajaxData),a.extend(j,b.ajaxData),a.isEmptyObject(i)?l():("function"==typeof o&&(i=o(i)),i?a.post(b.saveUrl,i,function(b){resp="string"==typeof b?a.parseJSON(b):b,resp.success?l(p(e,j,b)!==!1?!1:!0):l(!0)}):l())}function A(b,c){var d,e,f,g,h=0;switch(b){case"text":case"password":case"email":return a("<input>").addClass(c[3]).attr({id:c[0],name:c[0],type:b}).val(c[1]);case"select":return d=a("<select>").addClass(c[3]).attr({id:c[0],name:c[0]}),e="",a.each(c[2],function(a,b){e=b.toLowerCase()===c[1].toLowerCase()?' selected="selected"':"",d.append('<option value="'+a+'"'+e+">"+b+"</option>")}),e=f=g=h=c=null,a("<span>").addClass("se-field-container").html(d);case"checkbox":return f=c[1].toLowerCase()===c[2].on.toLowerCase()?!0:!1,g=a("<input>").addClass(c[3]).attr({id:c[0],type:"checkbox",name:c[0],checked:f}),f&&(g[0].defaultChecked=!0),e=f=h=c=null,a("<span>").addClass("se-field-container").html(g);case"radio":return d=a("<span>").addClass("se-field-container"),a.each(c[2],function(b,e){f=e.toLowerCase()===c[1].toLowerCase()?!0:!1,g=a("<input>").addClass(c[3]).attr({id:c[0]+""+(h+=1),type:"radio",name:c[0],value:b,checked:f}),f&&(g[0].defaultChecked=!0),d.append(g,e+"<br/>")}),e=f=g=h=c=null,d;case"textarea":return a("<textarea>").addClass(c[3]).attr({id:c[0],name:c[0],rows:3}).html(c[1]);case"datepicker":case"autocomplete":return k=function(){var d="object"==typeof c[2]?c[2]:{},e=a("#"+c[0]);"datepicker"===b?e.datepicker(d):"autocomplete"===b&&e.autocomplete(d)},a("<input>").addClass(c[3]).attr({id:c[0],name:c[0],type:"text"}).val(c[1])}}function B(a,b){var e=b.data("se-name"),f={};f=v(a,e),d[e].newValue=f.nval,d[e].newText=f.ntext,c[e]=f.nval,e=f=a=b=null}function C(c,e){function r(){z(m,j),"object"==typeof p&&p.validationEngine("detach"),m=j=p=o=null}function s(){y(m,j),u(),"object"==typeof p&&(p.validationEngine("detach"),p.validationEngine("hideAll")),m=j=p=o=null}function t(){p.validationEngine("validate")&&r()}h+=1;var p,j=c.clone(!0,!0),m=a("<div>").attr({id:"editingContainer_"+h,"data-se-type":e.data("elementType")}).addClass("simple-edit-container"),o=j.data("se-name");l?(p=a("<form>").html(e),p.validationEngine("attach",b.validationEngineOptions),f[o]=p,m.html(p)):m.html(e),m.append(q(),'<div class="simple-edit-clear"></div>'),i?m.bind("restore",function(a,c){if(!c){var e=n(j,d[o]);e!==!1&&(""===e?(e=b.placeholderText,j.addClass(b.placeholderClass)):j.removeClass(b.placeholderClass),j.html(e))}m.replaceWith(j),m=j=o=null}).delegate("input, select, textarea","change",function(){B(m,j)}).delegate("input, select, textarea","keydown",function(a){var b=a.keyCode||a.charCode,c=a.currentTarget.tagName.toLowerCase();return"textarea"!==c&&13===b||27===b?(a.preventDefault(),b=c=null,!1):(b=c=null,!0)}).find(".simple-edit-single").hide():m.delegate("span.simple-edit-save","click",function(){l?t():r()}).delegate("span.simple-edit-cancel","click",function(){s()}).delegate("input, select, textarea","keydown",function(a){var b=a.keyCode||a.charCode,c=a.currentTarget.tagName.toLowerCase();("textarea"!==c&&13===b||27===b)&&(a.preventDefault(),13===b?l?t():r():s()),b=c=null}),g.push(m),c.replaceWith(m),"function"==typeof k&&k(),i||m.find("input, select, textarea").eq(0).focus(),c=e=null}function D(c){c.preventDefault();var d=a(b.editAllTrigger),f=s();return i=!0,e=d.clone(!0,!0),d.replaceWith(f.delegate("span.simple-edit-msave","click",function(){x(function(){f.replaceWith(e),f=e=null})}).delegate("span.simple-edit-mcancel","click",function(){w(),f.replaceWith(e),f=e=null})),d=null,a(b.editClass).each(function(){a(this).trigger("dblclick")}),!1}function E(c){if(!i&&j||!c[0])return!1;j=!0;var o,p,e=a.trim(m(c)),f=c.data("se-type").toLowerCase(),g=c.data("se-opts"),h=c.data("se-ajax-data"),k=c.data("se-validation")||"",l=c.data("se-name"),n=[l,e,g,k];e.toLowerCase()===b.placeholderText.toLowerCase()?n[1]=e=p="":"object"==typeof g?a.each(g,function(a,b){return b===e?(p=a,!1):void 0}):p=e,o=A(f,n),o.data("elementType",f),C(c,o),d[l]={oldValue:p,oldText:e,newValue:p,newText:e,type:f,opts:g,localData:h},l=e=p=f=g=o=n=h=null}function F(c){a(b.editClass).each(function(){var c=a(this);""===a.trim(m(c))&&c.addClass(b.placeholderClass).html(b.placeholderText)}),a("body").delegate(b.editClass,"dblclick",function(){E(a(this))}),b.editAllDefault&&b.editAllTrigger&&(b.editAllDefault=!1,a(b.editAllTrigger).trigger("click")),!c||j||i||u()}function G(c){if(a.isEmptyObject(b)){if(b=a.extend({},a.simpleEdit.defaults,c),b.useValidationEngine&&"function"!=typeof a.fn.validationEngine&&(console.error("jQuery.validationEngine does not exist."),b.useValidationEngine=!1),""===b.saveUrl)return console.error("No 'saveUrl' was provided for jQuery.simpleEdit."),!1;if(l=b.useValidationEngine,m=b.beforeFilter,n=b.afterFilter,o=b.beforeSave,p=b.afterSave,"string"==typeof b.editAllTrigger&&""!==b.editAllTrigger)a(b.editAllTrigger).live("click",D);else if(b.editAllDefault)return console.error("editAllDefault was set to 'true' without valid editAllTrigger for jQuery.simpleEdit."),!1;F()}}function H(){a("body").undelegate(b.editClass,"dblclick"),a(b.editAllTrigger).die("click",D),u()}var k,l,m,n,o,p,c={},d={},e={},f={},g=[],h=0,i=!1,j=!1,q=function(){return a("<div>").addClass("simple-edit-single").html('<span class="simple-edit-save"><span class="ui-icon ui-icon-check"></span></span><span class="simple-edit-cancel"><span class="ui-icon ui-icon-closethick"></span></span><div class="simple-edit-loader"></div><div class="simple-edit-arrow-border"></div><div class="simple-edit-arrow"></div>')},s=function(){return a("<div>").addClass("simple-edit-mass").html('<span class="simple-edit-msave"><p>Save</p><span class="ui-icon ui-icon-check"></span></span><span class="simple-edit-mcancel"><p>Cancel</p><span class="ui-icon ui-icon-closethick"></span></span>')};return{init:G,update:F,destroy:H}}();a.simpleEdit=function(a,d){if("string"==typeof a&&c[a])"destroy"!==a&&c.init(),c[a].call();else if("string"==typeof a&&b[a]&&null!=d)b[a]=d;else{if("string"==typeof a&&b[a]&&null==d)return b[a];"object"!=typeof a&&a?console.error("Method "+a+" does not exist in jQuery.simpleEdit."):c.init(a)}},a.simpleEdit.defaults={saveUrl:window.location.href,editClass:".editable",editAllDefault:!1,editAllTrigger:"",ajaxData:{},beforeSave:function(a){return a},afterSave:function(){},beforeFilter:function(a){return a.text()},afterFilter:function(a,b){return b.newText},useValidationEngine:!1,validationEngineOptions:{scroll:!0},placeholderClass:"simple-edit-placeholder",placeholderText:"Double-click to Edit"}})(jQuery);
